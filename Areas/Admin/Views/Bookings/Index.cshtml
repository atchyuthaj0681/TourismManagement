@using TourismManagement.Models.ViewModels
@model BookingListViewModel

@{
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "Bookings List";
}

<h2 class="mb-4">Admin – Bookings</h2>

<div class="card shadow-sm p-3 mb-4">
    <form method="get" class="form-inline">
        <div class="form-group mr-3">
            <input type="text" name="searchString" value="@Model.SearchString" class="form-control" placeholder="Search by Package or User ID" />
        </div>

        <div class="form-group mr-3">
            <select name="paymentFilter" class="form-control">
                <option value="">All Payment Status</option>
                <option value="Paid" selected="@(Model.PaymentFilter == "Paid")">Paid</option>
                <option value="Pending" selected="@(Model.PaymentFilter == "Pending")">Pending</option>
                <option value="Refunded" selected="@(Model.PaymentFilter == "Refunded")">Refunded</option>
            </select>
        </div>

        <div class="form-group mr-3">
            <select name="bookingFilter" class="form-control">
                <option value="">All Booking Status</option>
                <option value="Confirmed" selected="@(Model.BookingFilter == "Confirmed")">Confirmed</option>
                <option value="Cancelled" selected="@(Model.BookingFilter == "Cancelled")">Cancelled</option>
                <option value="Completed" selected="@(Model.BookingFilter == "Completed")">Completed</option>
            </select>
        </div>

        <button type="submit" class="btn btn-primary">Filter</button>
        <a asp-area="Admin" asp-controller="Bookings" asp-action="Index" class="btn btn-secondary ml-2">Reset</a>
    </form>
</div>

<div class="card shadow-sm">
    <div class="card-body p-3">
        <div class="table-responsive">
            <table class="table table-striped table-hover table-bordered">
                <thead class="thead-dark">
                    <tr>
                        <th>Booking ID</th>
                        <th>Package</th>
                        <th>User ID</th>
                        <th>Booking Date</th>
                        <th>Tour Date</th>
                        <th>People</th>
                        <th>Total Price</th>
                        <th>Payment Status</th>
                        <th>Booking Status</th>
                        <th class="text-center">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @if (Model.Bookings.Any())
                    {
                        foreach (var booking in Model.Bookings)
                        {
                            <tr>
                                <td>@booking.Id</td>
                                <td>@booking.Package?.Title</td>
                                <td>@booking.UserId</td>
                                <td>@booking.BookingDate.ToString("MMM dd, yyyy")</td>
                                <td>@booking.TourDate.ToString("MMM dd, yyyy")</td>
                                <td>@booking.NumberOfPeople</td>
                                <td>@booking.TotalPrice.ToString("C")</td>
                                <td>
                                    <span class="badge
                                                @(booking.PaymentStatus == "Paid" ? "badge-success" :
                                                                                    booking.PaymentStatus == "Pending" ? "badge-warning" :
                                                                                    "badge-secondary")">
                                                                                                    @booking.PaymentStatus
                                                                                                </span>
                                                                                            </td>
                                                                                            <td>
                                                                                                <span class="badge
                                                @(booking.BookingStatus == "Confirmed" ? "badge-primary" :
                                                                                    booking.BookingStatus == "Cancelled" ? "badge-danger" :
                                                                                    booking.BookingStatus == "Completed" ? "badge-success" :
                                                                                    "badge-secondary")">
                                @booking.BookingStatus
                            </span>
                        </td>
                        <td class="text-center">
                            <a asp-area="Admin" asp-controller="Bookings" asp-action="Details" asp-route-id="@booking.Id" class="btn btn-info btn-sm mr-1" title="View Details">
                                <i class="fas fa-eye"></i>
                            </a>
                            <a asp-area="Admin" asp-controller="Bookings" asp-action="Edit" asp-route-id="@booking.Id" class="btn btn-warning btn-sm mr-1" title="Edit Booking">
                                <i class="fas fa-edit"></i>
                            </a>
                            <a asp-area="Admin" asp-controller="Bookings" asp-action="Delete" asp-route-id="@booking.Id" class="btn btn-danger btn-sm" title="Delete Booking">
                                <i class="fas fa-trash-alt"></i>
                            </a>
                        </td>
                    </tr>
                                        }
                    }
                    else
                    {
                        <tr><td colspan="10" class="text-center">No bookings found.</td></tr>
                    }
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        <nav aria-label="Page navigation" class="mt-3">
            <ul class="pagination justify-content-center">
                @if (Model.Pagination.CurrentPage > 1)
                {
                    <li class="page-item">
                        <a class="page-link" href="@Url.Action("Index", new { searchString = Model.SearchString, paymentFilter = Model.PaymentFilter, bookingFilter = Model.BookingFilter, pageNumber = Model.Pagination.CurrentPage - 1 })" aria-label="Previous">
                            <span aria-hidden="true">&laquo;</span>
                        </a>
                    </li>
                }
                else
                {
                    <li class="page-item disabled">
                        <span class="page-link">&laquo;</span>
                    </li>
                }

                @for (int i = 1; i <= Model.Pagination.TotalPages; i++)
                {
                    if (i == Model.Pagination.CurrentPage)
                    {
                        <li class="page-item active"><span class="page-link">@i</span></li>
                    }
                    else
                    {
                        <li class="page-item">
                            <a class="page-link" href="@Url.Action("Index", new { searchString = Model.SearchString, paymentFilter = Model.PaymentFilter, bookingFilter = Model.BookingFilter, pageNumber = i })">@i</a>
                        </li>
                    }
                }

                @if (Model.Pagination.CurrentPage < Model.Pagination.TotalPages)
                {
                    <li class="page-item">
                        <a class="page-link" href="@Url.Action("Index", new { searchString = Model.SearchString, paymentFilter = Model.PaymentFilter, bookingFilter = Model.BookingFilter, pageNumber = Model.Pagination.CurrentPage + 1 })" aria-label="Next">
                            <span aria-hidden="true">&raquo;</span>
                        </a>
                    </li>
                }
                else
                {
                    <li class="page-item disabled">
                        <span class="page-link">&raquo;</span>
                    </li>
                }
            </ul>
        </nav>
    </div>
</div>
